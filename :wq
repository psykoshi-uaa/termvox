#include <stdlib.h>
#include <curses.h>
#include "include/colors.h"
#include "include/pos.h"
#include "include/input.h"
#include "include/cell.h"
#include "include/island.h"

enum STATE {GENERATE, SIM, EXIT} typedef STATE;

void InitCurses();
void MainStateMachine(STATE* cur_state, char* user_inp, Island* island);

int main(){
	InitCurses();
	InitColors();

	STATE cur_state = GENERATE;
	char user_inp = ' ';
	
	Island* island = InitIsland();

	while( cur_state != EXIT ){
		MainStateMachine(&cur_state, &user_inp, island);
	}

	FreeIsland(island);
	endwin();
	return 0;
}

void MainStateMachine(STATE* cur_state, char* user_inp, Island* island){
	switch( *cur_state ){
	case GENERATE:
		IslandGenerateLand(island);
		*cur_state = SIM;
		break;
	case SIM:
		IslandEngine(island);
		*user_inp = GetCharInput(1, 'q');
		if( *user_inp == 'q' )
			*cur_state = EXIT;
		break;
	default:
		break;
	}
}

void InitCurses(){
	initscr();
	start_color();
	noecho();
	curs_set(0);
	keypad(stdscr, TRUE);
}
